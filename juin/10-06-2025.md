## âœ… TÃ¢ches effectuÃ©es

- CrÃ©ation dâ€™un batch pour identifier les `user` dont le champ `lastResetPassword` dÃ©passe 5 mois
    
- Envoi dâ€™e-mails avec lien de rÃ©initialisation de mot de passe aux `user` identifiÃ©s
    
- CrÃ©ation de deux modÃ¨les dâ€™e-mails distincts :
    
    - Mail de changement de mot de passe aprÃ¨s demande de lien
        
    - Mail dâ€™alerte indiquant que le mot de passe doit Ãªtre mis Ã  jour
        
- VÃ©rification de lâ€™ancien mot de passe dans lâ€™annuaire LDAP (AD)
    
- Gestion des messages dâ€™erreur cÃ´tÃ© front dans les cas suivants :
    
    - Ancien et nouveau mot de passe identiques
        
    - Nouveau mot de passe diffÃ©rent de la confirmation
        

---

## ğŸ“š Connaissances acquises

- 
	

---

## ğŸ ProblÃ¨mes rencontrÃ©s

- Le lien de rÃ©initialisation de mot de passe expire aprÃ¨s 15 minutes. En cas dâ€™envoi automatique, lâ€™utilisateur devra probablement en redemander un.
	

---

## ğŸ”œ Ã€ faire demain

- Tests
	

---

## ğŸ§© Notes / Code

```java
public boolean verifyOldPassword (String openldapId, String oldPassword) {  
  DirContext ctx = null;  
  try {  
    String dn = "cn=" + openldapId + "," + ldapBaseDn;  
    ctx = contextSource.getContext(dn, oldPassword);  
    return true;  
  } catch (NamingException e) {  
    logger.info("Le mot de passe tapÃ© ne correspond pas Ã  l'ancien mot de passe pour {}", openldapId);  
    return false;  
  } finally {  
    LdapUtils.closeContext(ctx);  
  }  
}
```

```bash
docker exec -it changementmdp-postgres bash
ce4c1117d84a:/ # psql -U user -d changementmdp
```

```bash
ldapsearch -x -H ldap://localhost:1389 -D "cn=admin,dc=example,dc=org" -w admin -b "ou=users,dc=example,dc=org" "(objectClass=person)"
```

```bash
# utile pour vÃ©rifier l'ancien mot de passe dans le terminal directement
ldapsearch -x -H ldap://localhost:1389   -D "cn=selym.oumakhlouf.ext.culture.gouv.fr,ou=users,dc=example,dc=org"   -w "NouveauMot123*"   -b "ou=users,dc=example,dc=org" "(objectClass=*)"
```